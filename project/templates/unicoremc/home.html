{% extends "unicoremc/base.html" %}

<!-- LOADING -->
{% load i18n %}

<!-- CONTENT -->
{% block content %}

{% if user.is_superuser %}
<a href="{% url 'new_project' %}" class="btn btn-primary">Start new project</a>
{% endif %}

<div id="projects_progress">
    <section id="grp-changelist">
    <div class="grp-module grp-changelist-results">
        <table id="result_list" cellspacing="0" class="table table-striped table-hover table-condensed">
            <thead>
                <tr>
                    <th scope="col">
                        <div class="grp-text">&nbsp;</div>
                    </th>
                    <th scope="col">
                        <div class="grp-text">&nbsp;</div>
                    </th>
                    <th scope="col">
                        <div class="grp-text">&nbsp;</div>
                    </th>
                    <th scope="col">
                        <div class="grp-text">&nbsp;</div>
                    </th>
                    <th scope="col">
                        <div class="grp-text">Frontend URL</div>
                    </th>
                    <th scope="col">
                        <div class="grp-text">CMS URL</div>
                    </th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    </section>
</div>
{% endblock %}

{% block script %}
<script src="{{STATIC_URL}}js/jquery.min.js"></script>
<script type="text/javascript">
function reload_projects(){
    $.getJSON('/progress/')
        .done(function(data){
            var projects = new Array();
            $.each(data, function(){
                var row = '<th>' + this.app_type +'</th>' +
                          '<td>' + this.country + '</td>' +
                          '<td>' + this.state + '</td>' +
                          '<td><a href="'+ this.repo_url +'">'+ this.repo_url +'</a></td>' +
                          '<td><a href="'+ this.frontend_url +'">'+ this.frontend_url +'</a></td>' +
                          '<td><a href="'+ this.cms_url +'">'+ this.cms_url +'</a></td>' +
                          '<td><a href="/advanced/'+ this.id +'/">'+ 'edit' +'</a></td>';

                var state_class = this.state == 'Done' ? 'bg-success' : 'bg-warning';
                console.log(state_class)
                projects.push(
                    $('<tr>').html(row).addClass(state_class));
            });
            $('#projects_progress tbody').html(projects)
    });
}

var timeout = null;
function refresh(){
    clearTimeout(timeout);
    timeout = setTimeout("refresh()", 3000);
    reload_projects();
}
$(document).ready(function() {
    refresh();
});
</script>
{% endblock %}
