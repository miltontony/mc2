{% extends 'base/inclusion_tags/controller_object.html' %}

{% block content-overlay %}
<div class="card-content-overlay content-overlay block">
  <!-- Widget: user widget style 1 -->
  <div class="box box-widget widget-user">
    <!-- Add the bg color to the header using any of the bg-* classes -->
    <div class="widget-user-header {% if controller.marathon_instances %}bg-navy{% else %}bg-gray{% endif %}">
      <h3 class="widget-user-username">{{controller.name}}</h3>
      <div class="widget-user-desc">{{controller.description}}</div>
      <div class="widget-user-desc">
          {# Didsplay the health of the app #}
          {% with controller.get_status as status %}
          <strong>{{controller.app_id }} </strong>
              {% if status.deploying %}
                  {% verbatim %}
                    (App is being deployed)
                  {% endverbatim %}
              {% endif %}
          <br/>
            {% if status.instances == 0 %}
                There are no instances of this app!<br/>
            {% else %}
                {# Display the number of instances of the app including the ones being staged (if available) #}
                Running instances: {{ status.running }} of {{ status.instances }}
                {% if status.staged != 0 %}
                    ({{ status.staged }} staged)
                {% endif %}
                <br/>
                {% if status.health_defined %}
                    {# If health is defined for the app, show the total number of healthy and unhealthy apps #}
                    <span class="label bg-green">{{ status.healthy }} healthy</span> | <span class="label bg-red">{{ status.unhealthy }} unhealthy</span><br/>
                {% else %}
                    <span class="label bg-orange">Health check not defined!</span><br/>
                {% endif %}
            {% endif %}
          {% endwith %}
      </div>
    </div>

    <div class="box-footer">
      <div class="row">
        <div class="border-right col-description">
          <div class="description-block app-view-action">
            <h5 class="description-header"><a class="text-green" href="#">View</a></h5>
            <span class="description-text"></span>
          </div>
          <!-- /.description-block -->
        </div>
        {% if user.is_superuser or is_admin %}
        <div class="border-right col-description">
          <div class="description-block">
            {% block edit_action %}
            <h5 class="description-header"><a href="{% url 'controllers.docker:edit' controller.id %}">Edit</a></h5>
            <span class="description-text"></span>
            {% endblock %}
          </div>
          <!-- /.description-block -->
        </div>
        <!-- /.col -->
        <div class="border-right col-description">
          <div class="description-block">
            {% block restart_action %}
              <h5 class="description-header"><a href="{% url 'base:restart' controller.id %}">Restart</a></h5>
              <span class="description-text"></span>
            {% endblock %}
          </div>
          <!-- /.description-block -->
        </div>
        <!-- /.col -->
        <div class="border-right col-description">
          <div class="description-block">
            {% block logs_action %}
              <h5 class="description-header"><a href="{% url 'base:logs' controller.id %}">Logs</a></h5>
              <span class="description-text"></span>
            {% endblock %}
          </div>
          <!-- /.description-block -->
        </div>
        <div class="border-right col-description">
          <div class="description-block">
            {% block clone_action %}
            <h5 class="description-header"><a href="{% url 'controllers.docker:clone' controller.id %}">Clone</a></h5>
            <span class="description-text"></span>
            {% endblock %}
          </div>
        </div>

        <!-- /.col -->
        <div class="border-right col-description">
          <div class="description-block delete app-delete-action">
            {% block delete_action %}
              <h5 class="description-header"><a class="text-red" href="{% url 'base:delete' controller.id %}">Delete</a></h5>
              <span class="description-text"></span>
            {% endblock %}
          </div>
          <!-- /.description-block -->
        </div>
        <!-- /.col -->
        {% endif %}
      </div>
      <!-- /.row -->
    </div>
  </div>
  <!-- /.widget-user -->
</div>
{% endblock %}
